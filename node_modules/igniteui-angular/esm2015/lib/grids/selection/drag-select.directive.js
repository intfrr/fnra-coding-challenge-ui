import { Directive, Input, Output, EventEmitter, ElementRef, NgZone } from '@angular/core';
import { interval, Subject } from 'rxjs';
import { filter, takeUntil } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
export var DragScrollDirection;
(function (DragScrollDirection) {
    DragScrollDirection[DragScrollDirection["NONE"] = 0] = "NONE";
    DragScrollDirection[DragScrollDirection["LEFT"] = 1] = "LEFT";
    DragScrollDirection[DragScrollDirection["TOP"] = 2] = "TOP";
    DragScrollDirection[DragScrollDirection["RIGHT"] = 3] = "RIGHT";
    DragScrollDirection[DragScrollDirection["BOTTOM"] = 4] = "BOTTOM";
    DragScrollDirection[DragScrollDirection["TOPLEFT"] = 5] = "TOPLEFT";
    DragScrollDirection[DragScrollDirection["TOPRIGHT"] = 6] = "TOPRIGHT";
    DragScrollDirection[DragScrollDirection["BOTTOMLEFT"] = 7] = "BOTTOMLEFT";
    DragScrollDirection[DragScrollDirection["BOTTOMRIGHT"] = 8] = "BOTTOMRIGHT";
})(DragScrollDirection || (DragScrollDirection = {}));
export class IgxGridDragSelectDirective {
    constructor(ref, zone) {
        this.ref = ref;
        this.zone = zone;
        this.onDragStop = new EventEmitter();
        this.onDragScroll = new EventEmitter();
        this.end$ = new Subject();
        this.lastDirection = DragScrollDirection.NONE;
        this.startDragSelection = (ev) => {
            if (!this.activeDrag) {
                return;
            }
            const x = ev.clientX;
            const y = ev.clientY;
            const direction = this._measureDimensions(x, y);
            if (direction === this.lastDirection) {
                return;
            }
            this.unsubscribe();
            this._sub = this._interval$.subscribe(() => this.onDragScroll.emit(direction));
            this.lastDirection = direction;
        };
        this.stopDragSelection = () => {
            if (!this.activeDrag) {
                return;
            }
            this.onDragStop.emit(false);
            this.unsubscribe();
            this.lastDirection = DragScrollDirection.NONE;
        };
        this._interval$ = interval(100).pipe(takeUntil(this.end$), filter(() => this.activeDrag));
    }
    get activeDrag() {
        return this._activeDrag;
    }
    set activeDrag(val) {
        if (val !== this._activeDrag) {
            this.unsubscribe();
            this._activeDrag = val;
        }
    }
    get nativeElement() {
        return this.ref.nativeElement;
    }
    get clientRect() {
        return this.nativeElement.getBoundingClientRect();
    }
    ngOnInit() {
        this.zone.runOutsideAngular(() => {
            this.nativeElement.addEventListener('pointerover', this.startDragSelection);
            this.nativeElement.addEventListener('pointerleave', this.stopDragSelection);
        });
    }
    ngOnDestroy() {
        this.zone.runOutsideAngular(() => {
            this.nativeElement.removeEventListener('pointerover', this.startDragSelection);
            this.nativeElement.removeEventListener('pointerleave', this.stopDragSelection);
        });
        this.unsubscribe();
        this.end$.complete();
    }
    _measureDimensions(x, y) {
        let direction;
        const rect = this.clientRect;
        const RATIO = 0.15;
        const offsetX = Math.trunc(x - rect.left);
        const offsetY = Math.trunc(y - rect.top);
        const left = offsetX <= rect.width * RATIO;
        const right = offsetX >= rect.width * (1 - RATIO);
        const top = offsetY <= rect.height * RATIO;
        const bottom = offsetY >= rect.height * (1 - RATIO);
        if (top && left) {
            direction = DragScrollDirection.TOPLEFT;
        }
        else if (top && right) {
            direction = DragScrollDirection.TOPRIGHT;
        }
        else if (bottom && left) {
            direction = DragScrollDirection.BOTTOMLEFT;
        }
        else if (bottom && right) {
            direction = DragScrollDirection.BOTTOMRIGHT;
        }
        else if (top) {
            direction = DragScrollDirection.TOP;
        }
        else if (bottom) {
            direction = DragScrollDirection.BOTTOM;
        }
        else if (left) {
            direction = DragScrollDirection.LEFT;
        }
        else if (right) {
            direction = DragScrollDirection.RIGHT;
        }
        else {
            direction = DragScrollDirection.NONE;
        }
        return direction;
    }
    unsubscribe() {
        if (this._sub) {
            this._sub.unsubscribe();
        }
    }
}
IgxGridDragSelectDirective.ɵfac = function IgxGridDragSelectDirective_Factory(t) { return new (t || IgxGridDragSelectDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
IgxGridDragSelectDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: IgxGridDragSelectDirective, selectors: [["", "igxGridDragSelect", ""]], inputs: { activeDrag: ["igxGridDragSelect", "activeDrag"] }, outputs: { onDragStop: "onDragStop", onDragScroll: "onDragScroll" } });
IgxGridDragSelectDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone }
];
IgxGridDragSelectDirective.propDecorators = {
    activeDrag: [{ type: Input, args: ['igxGridDragSelect',] }],
    onDragStop: [{ type: Output }],
    onDragScroll: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(IgxGridDragSelectDirective, [{
        type: Directive,
        args: [{
                selector: '[igxGridDragSelect]'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }]; }, { onDragStop: [{
            type: Output
        }], onDragScroll: [{
            type: Output
        }], activeDrag: [{
            type: Input,
            args: ['igxGridDragSelect']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZy1zZWxlY3QuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvZ3JpZHMvc2VsZWN0aW9uL2RyYWctc2VsZWN0LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBYSxNQUFNLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDOUcsT0FBTyxFQUFFLFFBQVEsRUFBNEIsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ25FLE9BQU8sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7O0FBRW5ELE1BQU0sQ0FBTixJQUFZLG1CQVVYO0FBVkQsV0FBWSxtQkFBbUI7QUFDOUIsSUFBRyw2REFBSSxDQUFBO0FBQUMsSUFDTCw2REFBSSxDQUFBO0FBQUMsSUFDTCwyREFBRyxDQUFBO0FBQUMsSUFDSiwrREFBSyxDQUFBO0FBQUMsSUFDTixpRUFBTSxDQUFBO0FBQUMsSUFDUCxtRUFBTyxDQUFBO0FBQUMsSUFDUixxRUFBUSxDQUFBO0FBQUMsSUFDVCx5RUFBVSxDQUFBO0FBQUMsSUFDWCwyRUFBVyxDQUFBO0FBQ2YsQ0FBQyxFQVZXLG1CQUFtQixLQUFuQixtQkFBbUIsUUFVOUI7QUFNRCxNQUFNLE9BQU8sMEJBQTBCO0FBQUcsSUFrQ3RDLFlBQW9CLEdBQWUsRUFBVSxJQUFZO0FBQzdELFFBRHdCLFFBQUcsR0FBSCxHQUFHLENBQVk7QUFBQyxRQUFTLFNBQUksR0FBSixJQUFJLENBQVE7QUFBQyxRQWxCMUQsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7QUFDN0MsUUFFSSxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUF1QixDQUFDO0FBQzNELFFBU2MsU0FBSSxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7QUFDeEMsUUFB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QztBQUNMO3NEQS9IQyxTQUFTLFNBQUMsa0JBQ1AsUUFBUSxFQUFFLHFCQUFxQixjQUNsQzsrUUFDSTtBQUFDO0FBQW9ELFlBcEJULFVBQVU7QUFBSSxZQUFTLE1BQU07QUFBRztBQUFHO0FBQ2pFLHlCQXNCZCxLQUFLLFNBQUMsbUJBQW1CO0FBQ3pCLHlCQVdBLE1BQU07QUFDVCwyQkFFRyxNQUFNO0FBQ1Y7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIE5nWm9uZSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpbnRlcnZhbCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuZXhwb3J0IGVudW0gRHJhZ1Njcm9sbERpcmVjdGlvbiB7XG4gICAgTk9ORSxcbiAgICBMRUZULFxuICAgIFRPUCxcbiAgICBSSUdIVCxcbiAgICBCT1RUT00sXG4gICAgVE9QTEVGVCxcbiAgICBUT1BSSUdIVCxcbiAgICBCT1RUT01MRUZULFxuICAgIEJPVFRPTVJJR0hUXG59XG5cblxuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICdbaWd4R3JpZERyYWdTZWxlY3RdJ1xufSlcbmV4cG9ydCBjbGFzcyBJZ3hHcmlkRHJhZ1NlbGVjdERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgICBfYWN0aXZlRHJhZzogYm9vbGVhbjtcblxuICAgIEBJbnB1dCgnaWd4R3JpZERyYWdTZWxlY3QnKVxuICAgIGdldCBhY3RpdmVEcmFnKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlRHJhZztcbiAgICB9XG5cbiAgICBzZXQgYWN0aXZlRHJhZyh2YWw6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKHZhbCAhPT0gdGhpcy5fYWN0aXZlRHJhZykge1xuICAgICAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZlRHJhZyA9IHZhbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBPdXRwdXQoKVxuICAgIG9uRHJhZ1N0b3AgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBvbkRyYWdTY3JvbGwgPSBuZXcgRXZlbnRFbWl0dGVyPERyYWdTY3JvbGxEaXJlY3Rpb24+KCk7XG5cbiAgICBnZXQgbmF0aXZlRWxlbWVudCgpOiBIVE1MRWxlbWVudCB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlZi5uYXRpdmVFbGVtZW50O1xuICAgIH1cblxuICAgIGdldCBjbGllbnRSZWN0KCk6IENsaWVudFJlY3Qge1xuICAgICAgICByZXR1cm4gdGhpcy5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBlbmQkID0gbmV3IFN1YmplY3Q8YW55PigpO1xuICAgIHByb3RlY3RlZCBsYXN0RGlyZWN0aW9uID0gRHJhZ1Njcm9sbERpcmVjdGlvbi5OT05FO1xuICAgIHByb3RlY3RlZCBfaW50ZXJ2YWwkOiBPYnNlcnZhYmxlPGFueT47XG4gICAgcHJvdGVjdGVkIF9zdWI6IFN1YnNjcmlwdGlvbjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIHpvbmU6IE5nWm9uZSkge1xuICAgICAgICB0aGlzLl9pbnRlcnZhbCQgPSBpbnRlcnZhbCgxMDApLnBpcGUoXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5lbmQkKSxcbiAgICAgICAgICAgIGZpbHRlcigoKSA9PiB0aGlzLmFjdGl2ZURyYWcpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcm92ZXInLCB0aGlzLnN0YXJ0RHJhZ1NlbGVjdGlvbik7XG4gICAgICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmxlYXZlJywgdGhpcy5zdG9wRHJhZ1NlbGVjdGlvbik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJvdmVyJywgdGhpcy5zdGFydERyYWdTZWxlY3Rpb24pO1xuICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsZWF2ZScsIHRoaXMuc3RvcERyYWdTZWxlY3Rpb24pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgICB0aGlzLmVuZCQuY29tcGxldGUoKTtcbiAgICB9XG5cblxuICAgIHN0YXJ0RHJhZ1NlbGVjdGlvbiA9IChldjogUG9pbnRlckV2ZW50KSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5hY3RpdmVEcmFnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeCA9IGV2LmNsaWVudFg7XG4gICAgICAgIGNvbnN0IHkgPSBldi5jbGllbnRZO1xuICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLl9tZWFzdXJlRGltZW5zaW9ucyh4LCB5KTtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gdGhpcy5sYXN0RGlyZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgICB0aGlzLl9zdWIgPSB0aGlzLl9pbnRlcnZhbCQuc3Vic2NyaWJlKCgpID0+IHRoaXMub25EcmFnU2Nyb2xsLmVtaXQoZGlyZWN0aW9uKSk7XG4gICAgICAgIHRoaXMubGFzdERpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICB9XG5cbiAgICBzdG9wRHJhZ1NlbGVjdGlvbiA9ICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZURyYWcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9uRHJhZ1N0b3AuZW1pdChmYWxzZSk7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgdGhpcy5sYXN0RGlyZWN0aW9uID0gRHJhZ1Njcm9sbERpcmVjdGlvbi5OT05FO1xuICAgIH1cblxuICAgIF9tZWFzdXJlRGltZW5zaW9ucyh4OiBudW1iZXIsIHk6IG51bWJlcik6IERyYWdTY3JvbGxEaXJlY3Rpb24ge1xuICAgICAgICBsZXQgZGlyZWN0aW9uOiBEcmFnU2Nyb2xsRGlyZWN0aW9uO1xuXG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNsaWVudFJlY3Q7XG4gICAgICAgIGNvbnN0IFJBVElPID0gMC4xNTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0WCA9IE1hdGgudHJ1bmMoeCAtIHJlY3QubGVmdCk7XG4gICAgICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLnRydW5jKHkgLSByZWN0LnRvcCk7XG5cbiAgICAgICAgY29uc3QgbGVmdCA9IG9mZnNldFggPD0gcmVjdC53aWR0aCAqIFJBVElPO1xuICAgICAgICBjb25zdCByaWdodCA9IG9mZnNldFggPj0gcmVjdC53aWR0aCAqICgxIC0gUkFUSU8pO1xuICAgICAgICBjb25zdCB0b3AgPSBvZmZzZXRZIDw9IHJlY3QuaGVpZ2h0ICogUkFUSU87XG4gICAgICAgIGNvbnN0IGJvdHRvbSA9IG9mZnNldFkgPj0gcmVjdC5oZWlnaHQgKiAoMSAtIFJBVElPKTtcblxuICAgICAgICBpZiAodG9wICYmIGxlZnQpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IERyYWdTY3JvbGxEaXJlY3Rpb24uVE9QTEVGVDtcbiAgICAgICAgfSBlbHNlIGlmICh0b3AgJiYgcmlnaHQpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IERyYWdTY3JvbGxEaXJlY3Rpb24uVE9QUklHSFQ7XG4gICAgICAgIH0gZWxzZSBpZiAoYm90dG9tICYmIGxlZnQpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IERyYWdTY3JvbGxEaXJlY3Rpb24uQk9UVE9NTEVGVDtcbiAgICAgICAgfSBlbHNlIGlmIChib3R0b20gJiYgcmlnaHQpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IERyYWdTY3JvbGxEaXJlY3Rpb24uQk9UVE9NUklHSFQ7XG4gICAgICAgIH0gZWxzZSBpZiAodG9wKSB7XG4gICAgICAgICAgICBkaXJlY3Rpb24gPSBEcmFnU2Nyb2xsRGlyZWN0aW9uLlRPUDtcbiAgICAgICAgfSBlbHNlIGlmIChib3R0b20pIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IERyYWdTY3JvbGxEaXJlY3Rpb24uQk9UVE9NO1xuICAgICAgICB9IGVsc2UgaWYgKGxlZnQpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IERyYWdTY3JvbGxEaXJlY3Rpb24uTEVGVDtcbiAgICAgICAgfSBlbHNlIGlmIChyaWdodCkge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gRHJhZ1Njcm9sbERpcmVjdGlvbi5SSUdIVDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IERyYWdTY3JvbGxEaXJlY3Rpb24uTk9ORTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaXJlY3Rpb247XG5cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgdW5zdWJzY3JpYmUoKSB7XG4gICAgICAgIGlmICh0aGlzLl9zdWIpIHtcbiAgICAgICAgICAgIHRoaXMuX3N1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19